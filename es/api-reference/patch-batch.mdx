---
title: 'PATCH /invoices/batches/{id} - Agregar Facturas a Lote'
description: 'Documentaci√≥n para agregar facturas a un lote existente'
---

# üì¶ PATCH /invoices/batches/{id} - Agregar Facturas a Lote

Este endpoint te permite agregar facturas adicionales a un lote existente que a√∫n no ha sido completado.

## URL Base

```
https://facture.ar/api/invoices/batches/{id}
```

## Autenticaci√≥n

Todas las peticiones requieren autenticaci√≥n usando:

- **Sesi√≥n Web**: Para aplicaciones basadas en navegador
- **API Key**: Para integraciones servidor a servidor

Incluye tu API key en el header `x-api-key`:

```bash
x-api-key: tu-api-key-aqui
```

## Par√°metros de Ruta

| Par√°metro | Tipo | Requerido | Descripci√≥n | Ejemplo |
| --------- | ---- | --------- | ----------- | ------- |
| `id`      | string | ‚úÖ        | ID √∫nico del lote | `"123e4567-e89b-12d3-a456-426614174000"` |

## Cuerpo de la Petici√≥n

```json
[
  {
    "amount": 1000.0,
    "description": "Venta de servicios",
    "cuitId": "456e7890-e89b-12d3-a456-426614174001"
  },
  {
    "amount": 2000.0,
    "description": "Venta de productos",
    "cuitId": "456e7890-e89b-12d3-a456-426614174001"
  }
]
```

## Par√°metros del Cuerpo

| Par√°metro | Tipo | Requerido | Descripci√≥n | Ejemplo |
| --------- | ---- | --------- | ----------- | ------- |
| `amount` | number | ‚úÖ | Monto total de la factura | `1000.0` |
| `description` | string | ‚úÖ | Descripci√≥n de la factura | `"Venta de servicios"` |
| `cuitId` | string | ‚ùå | ID del CUIT (usa por defecto si no se especifica) | `"456e7890-e89b-12d3-a456-426614174001"` |

## Respuesta

### √âxito (200)

```json
{
  "batch": true,
  "message": "Facturas agregadas al lote exitosamente",
  "count": 2,
  "status": "processing",
  "batchId": "123e4567-e89b-12d3-a456-426614174000",
  "queueIdentifiers": ["production_cuit-id_1_11"]
}
```

### Respuestas de Error

#### Lote No Encontrado (404)

```json
{
  "error": "Lote no encontrado",
  "details": "The requested batch does not exist"
}
```

#### Lote Completado (400)

```json
{
  "error": "No se pueden agregar facturas a un lote completado",
  "details": "El lote est√° en estado: completed"
}
```

#### No Autorizado (403)

```json
{
  "error": "No autorizado",
  "details": "You don't have access to this batch"
}
```

#### Error de Validaci√≥n (400)

```json
{
  "error": "Datos inv√°lidos en el lote",
  "details": [
    {
      "field": "amount",
      "message": "Amount must be a positive number"
    }
  ]
}
```

#### L√≠mite de Suscripci√≥n (403)

```json
{
  "error": "Subscription limit exceeded",
  "details": "Monthly invoice limit reached"
}
```

## Restricciones

- **Estado del Lote**: Solo se pueden agregar facturas a lotes en estado `pending` o `processing`
- **L√≠mite de Items**: M√°ximo 500 facturas por lote
- **L√≠mite de Suscripci√≥n**: Sujeto a los l√≠mites de tu plan de suscripci√≥n
- **Validaci√≥n**: Todas las facturas deben pasar la validaci√≥n antes de ser agregadas

## Estados de Lote V√°lidos

| Estado | Permite Agregar Facturas |
| ------ | ----------------------- |
| `pending` | ‚úÖ S√≠ |
| `processing` | ‚úÖ S√≠ |
| `completed` | ‚ùå No |
| `completed_with_errors` | ‚ùå No |
| `error` | ‚ùå No |

## Ejemplos de Uso

### Agregar Facturas Simples

```bash
curl -X PATCH https://facture.ar/api/invoices/batches/123e4567-e89b-12d3-a456-426614174000 \
  -H "Content-Type: application/json" \
  -H "x-api-key: tu-api-key" \
  -d '[
    {
      "amount": 1000.0,
      "description": "Venta de servicios"
    },
    {
      "amount": 2000.0,
      "description": "Venta de productos"
    }
  ]'
```

### Agregar Facturas con CUIT Espec√≠fico

```bash
curl -X PATCH https://facture.ar/api/invoices/batches/123e4567-e89b-12d3-a456-426614174000 \
  -H "Content-Type: application/json" \
  -H "x-api-key: tu-api-key" \
  -d '[
    {
      "amount": 1000.0,
      "description": "Venta de servicios",
      "cuitId": "456e7890-e89b-12d3-a456-426614174001"
    }
  ]'
```

### JavaScript/Node.js

```javascript
// Agregar facturas a un lote existente
const response = await fetch('https://facture.ar/api/invoices/batches/123e4567-e89b-12d3-a456-426614174000', {
  method: 'PATCH',
  headers: {
    'Content-Type': 'application/json',
    'x-api-key': 'tu-api-key',
  },
  body: JSON.stringify([
    {
      amount: 1000.0,
      description: 'Venta de servicios',
      cuitId: '456e7890-e89b-12d3-a456-426614174001'
    },
    {
      amount: 2000.0,
      description: 'Venta de productos',
      cuitId: '456e7890-e89b-12d3-a456-426614174001'
    }
  ]),
});

const result = await response.json();
console.log('Facturas agregadas:', result);

if (result.batch) {
  console.log(`Se agregaron ${result.count} facturas al lote ${result.batchId}`);
}
```

### Python

```python
import requests

# Agregar facturas a un lote existente
response = requests.patch(
    'https://facture.ar/api/invoices/batches/123e4567-e89b-12d3-a456-426614174000',
    headers={
        'Content-Type': 'application/json',
        'x-api-key': 'tu-api-key'
    },
    json=[
        {
            'amount': 1000.0,
            'description': 'Venta de servicios',
            'cuitId': '456e7890-e89b-12d3-a456-426614174001'
        },
        {
            'amount': 2000.0,
            'description': 'Venta de productos',
            'cuitId': '456e7890-e89b-12d3-a456-426614174001'
        }
    ]
)

result = response.json()
print('Facturas agregadas:', result)

if result.get('batch'):
    print(f"Se agregaron {result['count']} facturas al lote {result['batchId']}")
```

## ‚ùì Soluci√≥n de Problemas

<Accordion title="Error: Lote completado">
**Causa**: Intentas agregar facturas a un lote que ya fue completado.

**Soluci√≥n**:

1. Verifica el estado del lote antes de intentar agregar facturas
2. Crea un nuevo lote si necesitas agregar m√°s facturas
3. Solo se pueden agregar facturas a lotes en estado `pending` o `processing`
</Accordion>

<Accordion title="Error: L√≠mite de suscripci√≥n excedido">
**Causa**: Has alcanzado el l√≠mite mensual de facturas de tu plan.

**Soluci√≥n**:

1. Verifica tu l√≠mite de suscripci√≥n actual
2. Espera al pr√≥ximo per√≠odo de facturaci√≥n
3. Considera actualizar tu plan si necesitas m√°s facturas
</Accordion>

<Accordion title="Error: Datos inv√°lidos">
**Causa**: Los datos de las facturas no pasan la validaci√≥n.

**Soluci√≥n**:

1. Revisa los detalles del error en la respuesta
2. Corrige los datos seg√∫n los mensajes de error
3. Aseg√∫rate de que todos los campos requeridos est√©n presentes
</Accordion>

## üìû Soporte

Para soporte t√©cnico o preguntas sobre la API:

- üìß **Email**: support@facture.ar
- üí¨ **Chat**: Disponible en la plataforma
- üìö **Documentaci√≥n**: Explora nuestros ejemplos detallados
- üé• **Videollamada**: Para asistencia personalizada
